<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Connection</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #fff; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #333; border-radius: 5px; }
        .success { background: #1a4d1a; border-color: #2d7a2d; }
        .error { background: #4d1a1a; border-color: #7a2d2d; }
        .pending { background: #4d4d1a; border-color: #7a7a2d; }
        pre { background: #000; padding: 10px; overflow: auto; }
    </style>
</head>
<body>
    <h1>üîç Connection Diagnostic</h1>
    <div id="results"></div>

    <script>
        const results = document.getElementById('results');
        
        function addResult(title, status, data) {
            const div = document.createElement('div');
            div.className = `test ${status}`;
            div.innerHTML = `
                <h3>${title}</h3>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
            results.appendChild(div);
        }

        // Test 1: Check window.location
        addResult('1. Window Location', 'pending', {
            hostname: window.location.hostname,
            port: window.location.port,
            href: window.location.href
        });

        // Test 2: API URL Detection
        const API_BASE = window.location.hostname === 'localhost' 
            ? 'http://localhost:8080' 
            : '';
        const HEALTH_URL = `${API_BASE}/api/health`;
        
        addResult('2. Detected URLs', 'pending', {
            API_BASE,
            HEALTH_URL
        });

        // Test 3: Fetch health endpoint
        console.log('Testing fetch to:', HEALTH_URL);
        
        fetch(HEALTH_URL, {
            method: 'GET',
            mode: 'cors',
            cache: 'no-cache'
        })
        .then(response => {
            console.log('Response status:', response.status);
            console.log('Response ok:', response.ok);
            console.log('Response headers:', response.headers);
            
            addResult('3. Fetch Response', response.ok ? 'success' : 'error', {
                status: response.status,
                statusText: response.statusText,
                ok: response.ok,
                headers: {
                    'content-type': response.headers.get('content-type'),
                    'access-control-allow-origin': response.headers.get('access-control-allow-origin')
                }
            });
            
            return response.json();
        })
        .then(data => {
            console.log('Response data:', data);
            addResult('4. Response Data', 'success', data);
        })
        .catch(error => {
            console.error('Fetch error:', error);
            addResult('3. Fetch Failed', 'error', {
                message: error.message,
                stack: error.stack
            });
        });
    </script>
</body>
</html>
