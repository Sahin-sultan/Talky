<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chrome Debug Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            background: #1a1a2e; 
            color: #eee; 
            padding: 20px; 
        }
        .log { 
            background: #16213e; 
            padding: 15px; 
            margin: 10px 0; 
            border-left: 4px solid #0f3460;
            border-radius: 4px;
        }
        .success { border-left-color: #4CAF50; }
        .error { border-left-color: #f44336; background: #2e1616; }
        button { 
            background: #0f3460; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            cursor: pointer; 
            border-radius: 4px;
            margin: 5px;
        }
        button:hover { background: #1a5490; }
        pre { background: #000; padding: 10px; overflow: auto; }
    </style>
</head>
<body>
    <h1>üîç Chrome Connection Test</h1>
    <p>Open Chrome DevTools (F12) ‚Üí Console tab to see detailed logs</p>
    
    <div>
        <button onclick="testHealth()">Test /api/health</button>
        <button onclick="testChat()">Test /api/chat</button>
        <button onclick="clearLogs()">Clear Logs</button>
    </div>
    
    <div id="logs"></div>

    <script>
        const logsDiv = document.getElementById('logs');

        function addLog(message, isError = false) {
            const log = document.createElement('div');
            log.className = `log ${isError ? 'error' : 'success'}`;
            log.innerHTML = `
                <strong>${new Date().toLocaleTimeString()}</strong><br>
                ${message}
            `;
            logsDiv.insertBefore(log, logsDiv.firstChild);
        }

        function clearLogs() {
            logsDiv.innerHTML = '';
        }

        async function testHealth() {
            const url = 'http://localhost:8080/api/health';
            addLog(`Testing: ${url}`);
            console.log('Testing health endpoint:', url);

            try {
                const response = await fetch(url, {
                    method: 'GET',
                    mode: 'cors',
                    cache: 'no-cache',
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                console.log('Response:', response);
                console.log('Status:', response.status);
                console.log('Headers:', [...response.headers.entries()]);

                if (response.ok) {
                    const data = await response.json();
                    console.log('Data:', data);
                    addLog(`‚úÖ SUCCESS!<br><pre>${JSON.stringify(data, null, 2)}</pre>`);
                } else {
                    const text = await response.text();
                    console.error('Error response:', text);
                    addLog(`‚ùå HTTP ${response.status}: ${text}`, true);
                }
            } catch (error) {
                console.error('Fetch error:', error);
                addLog(`‚ùå ERROR: ${error.message}<br><pre>${error.stack}</pre>`, true);
            }
        }

        async function testChat() {
            const url = 'http://localhost:8080/api/chat';
            const body = {
                messages: [
                    { role: 'user', content: 'Hello, test message!' }
                ]
            };

            addLog(`Testing: POST ${url}`);
            console.log('Testing chat endpoint:', url, body);

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    mode: 'cors',
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(body)
                });

                console.log('Response:', response);
                console.log('Status:', response.status);

                if (response.ok) {
                    const data = await response.json();
                    console.log('Data:', data);
                    addLog(`‚úÖ CHAT SUCCESS!<br><pre>${JSON.stringify(data, null, 2)}</pre>`);
                } else {
                    const text = await response.text();
                    console.error('Error response:', text);
                    addLog(`‚ùå HTTP ${response.status}: ${text}`, true);
                }
            } catch (error) {
                console.error('Fetch error:', error);
                addLog(`‚ùå ERROR: ${error.message}<br><pre>${error.stack}</pre>`, true);
            }
        }

        // Auto-test on load
        window.addEventListener('load', () => {
            console.log('Page loaded, running auto-test...');
            setTimeout(testHealth, 500);
        });
    </script>
</body>
</html>
